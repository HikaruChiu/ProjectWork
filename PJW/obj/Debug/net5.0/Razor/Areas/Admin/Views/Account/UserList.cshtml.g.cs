#pragma checksum "D:\MyProject\PJW\PJW\Areas\Admin\Views\Account\UserList.cshtml" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "354ad1ea25acc84c54c81f15dcc15c070187bdea"
// <auto-generated/>
#pragma warning disable 1591
[assembly: global::Microsoft.AspNetCore.Razor.Hosting.RazorCompiledItemAttribute(typeof(AspNetCore.Areas_Admin_Views_Account_UserList), @"mvc.1.0.view", @"/Areas/Admin/Views/Account/UserList.cshtml")]
namespace AspNetCore
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Mvc;
    using Microsoft.AspNetCore.Mvc.Rendering;
    using Microsoft.AspNetCore.Mvc.ViewFeatures;
    [global::Microsoft.AspNetCore.Razor.Hosting.RazorSourceChecksumAttribute(@"SHA1", @"354ad1ea25acc84c54c81f15dcc15c070187bdea", @"/Areas/Admin/Views/Account/UserList.cshtml")]
    public class Areas_Admin_Views_Account_UserList : global::Microsoft.AspNetCore.Mvc.Razor.RazorPage<dynamic>
    {
        #pragma warning disable 1998
        public async override global::System.Threading.Tasks.Task ExecuteAsync()
        {
#nullable restore
#line 1 "D:\MyProject\PJW\PJW\Areas\Admin\Views\Account\UserList.cshtml"
  
    ViewBag.Title = "系統使用者";
    Layout = "~/Views/Shared/_Layout.cshtml";

#line default
#line hidden
#nullable disable
            WriteLiteral(@"

<div class=""wrapper wrapper-content animated fadeInRight"">
    <div class=""ibox float-e-margins"">
        <div class=""ibox-content"">
            <div class=""row row-lg"">
                <div class=""col-sm-12"">
                    <div>
                        <div>
                            <div class=""btn-group hidden-xs"" id=""SystemUsewrTableEventsToolbar"" role=""group"">
                                <button type=""button"" action-id=""role-add"" action-name=""授予角色"" class=""btn btn-w-m btn-success authorization"" style=""display: none;margin-right: 10px"" v-on:click=""_roleAdd"">授予角色</button>
                                <button type=""button"" action-id=""user-delete"" action-name=""禁用使用者"" class=""btn btn-w-m btn-danger authorization"" style=""display: none;margin-right: 10px"" v-on:click=""_userDelete"">禁用使用者</button>
                                <button type=""button"" action-id=""user-add"" action-name=""新增使用者"" class=""btn btn-w-m btn-success authorization"" style=""display: none;margin-right: 10px"" v-on:click=""_userAdd"">新");
            WriteLiteral(@"增使用者</button>
                                <div class=""input-group"" style=""display: inline-block"">
                                    <input type=""text"" class=""form-control  input-md"" id=""UserName"" placeholder=""使用者姓名"" style=""width: 150px;display: inline-block"" v-on:keyup.enter=""_FreshTable"" data-pure-clear-button>
                                </div>
                                <div class=""input-group"" style=""display: inline-block"">
                                    <input type=""text"" class=""form-control  input-md"" placeholder=""使用者登入帳號"" id=""Eid"" style=""width: 150px;display: inline-block"" v-on:keyup.enter=""_FreshTable"" data-pure-clear-button>
                                </div>
                                <input class=""js-example-data-array-selected text-box"" id=""roleCombox1"" style=""width: 150px;vertical-align: initial;"" />
                            </div>
                            <table id=""SystemUsewrTable"" data-side-pagination=""server"" data-sort-order=""desc"" data-mobile-responsive=""t");
            WriteLiteral(@"rue""></table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class=""modal inmodal"" id=""userAddModel"" tabindex=""-1"" role=""dialog"" aria-hidden=""true"">
    <div class=""modal-dialog"">
        <div class=""modal-content"">
            <div class=""modal-header"">
                <h4 class=""modal-title"" style=""color: red"">新增使用者!</h4>
            </div>
            <div class=""modal-body"">
                <div class=""form-group"">
                    <label class=""control-label"">登入名稱(英文)：</label>
                    <input class=""form-control"" type=""text"" v-model=""currentUser.Eid"" placeholder=""請輸入登入名稱(英文)"" data-pure-clear-button>
                </div>
                <div class=""form-group"">
                    <label class=""control-label"">姓名：</label>
                    <input class=""form-control"" type=""text"" v-model=""currentUser.UserName"" placeholder=""請輸入姓名"" data-pure-clear-button>
                </div>
                <div cl");
            WriteLiteral(@"ass=""form-group"">
                    <label class=""control-label"">密碼：</label>
                    <input class=""form-control"" type=""text"" v-model=""currentUser.Pwd"" placeholder=""請輸入密碼"" data-pure-clear-button>
                </div>
                <div class=""form-group"">
                    <label class=""control-label"">角色列表：</label>
                    <input class=""js-example-data-array-selected text-box"" id=""roleCombox2"" style=""width: 350px;"" />
                </div>
            </div>
            <div class=""modal-footer"">
                <button type=""button"" class=""btn btn-white"" v-on:click=""_CloseAdd"">關閉</button>
                <button type=""button"" class=""btn btn-primary"" v-on:click=""_SaveAdd"">提交</button>
            </div>
        </div>
    </div>
</div>

<div class=""modal inmodal"" id=""myModal"" tabindex=""-1"" role=""dialog"" aria-hidden=""true"">
    <div class=""modal-dialog"">
        <div class=""modal-content"">
            <div class=""modal-header"">
                <h4 v-if=""noRole"" class=""modal-title");
            WriteLiteral(@""" style=""color: red"">請先建立角色!</h4>
                <h1 v-else class=""modal-title"">請選擇角色</h1>
            </div>
            <div class=""modal-body"">
                <div class=""form-group"">
                    <label class=""control-label"">角色列表：</label>
                    <input class=""js-example-data-array-selected text-box"" id=""roleCombox"" style=""width: 350px;"" />
                </div>
            </div>
            <div class=""modal-footer"">
                <button type=""button"" class=""btn btn-white"" id=""close-model"" v-on:click=""_Close"">關閉</button>
                <button type=""button"" action-id=""role-add"" action-name=""授予角色"" class=""btn btn-primary authorization"" id=""save-model"" v-on:click=""_Save"">提交</button>
            </div>
        </div>
    </div>
</div>
");
            DefineSection("Scripts", async() => {
                WriteLiteral(@"
    <script type=""text/javascript"">
        var $roleCombox = $(""#roleCombox"");
        var PM = null;
        var eids = [];
        var vm = new Vue({
            el: 'body',
            data: {
                noRole: true,
                currentRow: {},
                currentUser: {}
            },
            computed: {},
            ready: function () {
                auth();
            },
            methods: {
                _FreshTable: function () {
                    try {
                        $("".bootstrap-table button[name='refresh']"")[0].click();
                    } catch (e) {

                    }
                },
                _SaveAdd: function () {
                    //儲存使用者
                    if (!vm.currentUser.Eid) {
                        swal({
                            title: """",
                            text: ""請輸入登入名稱！"",
                            type: ""error""
                        });
                        return;
                    }

              ");
                WriteLiteral(@"      if (!vm.currentUser.UserName) {
                        swal({
                            title: """",
                            text: ""請輸入姓名！"",
                            type: ""error""
                        });
                        return;
                    }
                    if (!vm.currentUser.Pwd) {
                        swal({
                            title: """",
                            text: ""請輸入密碼！"",
                            type: ""error""
                        });
                        return;
                    }

                    var roleTid = $('#roleCombox2').select2('data') && $('#roleCombox2').select2('data').id;
                    if (!roleTid) {
                        swal({
                            title: """",
                            text: ""請選擇角色！"",
                            type: ""error""
                        });
                        return;
                    }
                    vm.currentUser.RoleTid = roleTid;
                    QQT.a");
                WriteLiteral(@"jax('/Admin/Account/UserAdd', 'Post', vm.currentUser)
                        .done(function (response) {
                            $('#SystemUsewrTable').bootstrapTable('refresh', { silent: true });
                            swal(""成功啦！"", ""新增成功!"", ""success"");
                            vm._CloseAdd();
                        });
                },
                _CloseAdd: function () {
                    this.currentUser = {};
                    $('#roleCombox2').val(null).trigger(""change"");
                    $('#userAddModel').modal('hide');
                },
                _userAdd: function () {
                    $('#userAddModel').modal({ backdrop: 'static', keyboard: false });
                    $('#userAddModel').modal('show');

                },
                _roleAdd: function () {
                    var selectRow = $('#SystemUsewrTable').bootstrapTable('getSelections');
                    if (selectRow.length < 1) {
                        swal({
                            title");
                WriteLiteral(@": """",
                            text: ""請選擇使用者！"",
                            type: ""error""
                        });
                        return;
                    }
                    
                    vm.currentRow = $.extend({}, selectRow[0]);
                    if (vm.currentRow.RoleTid) {
                        $roleCombox.select2(""val"", vm.currentRow.RoleTid);
                    }

                    $('#myModal').modal({ backdrop: 'static', keyboard: false });
                    $('#myModal').modal('show');
                },
                _Close: function () {
                    $roleCombox.val(null).trigger(""change"");
                    $('#myModal').modal('hide');
                },
                _Save: function () {
                    if (!$roleCombox.select2('data')) {
                        swal({
                            title: """",
                            text: ""請選擇角色！"",
                            type: ""error""
                        });
                       ");
                WriteLiteral(@" return;
                    }
                    var roleTid = $roleCombox.select2('data').id;
                    var roleName = $roleCombox.select2('data').text;
                    swal({
                        title: ""您確定要賦予角色["" + roleName + ""]嗎?"",
                        text: ""請謹慎操作！"",
                        type: ""warning"",
                        showCancelButton: true,
                        confirmButtonColor: ""#DD6B55"",
                        confirmButtonText: ""朕準了！"",
                        cancelButtonText: ""讓朕再考慮一下…"",
                        showLoaderOnConfirm: true,
                        preConfirm: function () {
                            return QQT.ajax('/Admin/Account/UserAddRole',
                                'Post',
                                {
                                    UserTid: vm.currentRow.Tid,
                                    RoleTid: roleTid
                                });
                        }
                    }).then(function (response) {
 ");
                WriteLiteral(@"                       $('#SystemUsewrTable').bootstrapTable('refresh', { silent: true });
                        swal(""成功啦！"", ""角色已賦予成功!"", ""success"");
                        $roleCombox.val(null).trigger(""change"");
                        $('#myModal').modal('hide');
                    }).catch(function() {
                    });
                },
                _userDelete: function () {
                    var selectRow = $('#SystemUsewrTable').bootstrapTable('getSelections');
                    if (selectRow.length < 1) {
                        swal({
                            title: """",
                            text: ""請選擇使用者！"",
                            type: ""error""
                        });
                        return;
                    }
                    var row = $.extend({}, selectRow[0]);
                    swal({
                        title: ""您確定要禁用使用者["" + row.UserName + ""]嗎?"",
                        text: ""請謹慎操作！"",
                        type: ""warning"",
             ");
                WriteLiteral(@"           showCancelButton: true,
                        confirmButtonColor: ""#DD6B55"",
                        confirmButtonText: ""朕準了！"",
                        cancelButtonText: ""讓朕再考慮一下…"",
                        showLoaderOnConfirm: true,
                        preConfirm: function (isConfirm) {
                            return QQT.ajax('/Admin/Account/UserDelete',
                                    'Post',
                                    {
                                        UserTid: row.Tid
                                    });
                        }
                    }).then(function (response) {
                        $('#SystemUsewrTable').bootstrapTable('refresh', { silent: true });
                        swal(""成功啦！"", ""該使用者已被禁用!"", ""success"");
                    }).catch(function () {
                    });
                  
                }
            }
        });

        $(function () {
            $('#SystemUsewrTable')
                .bootstrapTable({
             ");
                WriteLiteral(@"       ajax: ajaxRequest,
                    pageNumber: 1,
                    pageSize: 25,
                    pageList: [10, 25, 50, 100],
                    resetOffset: true,
                    search: false,
                    sortable: true,
                    pagination: true,
                    height: $(window).height(),
                    showRefresh: true,
                    showToggle: true,
                    showColumns: false,
                    striped: true,
                    sortOrder: 'desc',
                    clickToSelect: true,
                    singleSelect: true,
                    cache: false,
                    // showPaginationSwitch:true,
                    dataType: ""json"",
                    iconSize: 'outline',
                    toolbar: '#SystemUsewrTableEventsToolbar',
                    icons: {
                        refresh: 'glyphicon-refresh',
                        toggleOff: 'glyphicon-list-alt icon-list-alt',
                        toggleOn");
                WriteLiteral(@": 'glyphicon-list-alt icon-list-alt',
                        columns: 'glyphicon-list'
                    },
                    columns: [
                        {
                            field: 'state',
                            title: '',
                            checkbox: true
                        },
                        {
                            field: 'Eid',
                            title: '登入帳號'
                        },
                        {
                            field: 'UserName',
                            title: '姓名'
                        },
                        {
                            field: 'Phone',
                            title: '聯繫手機',
                            editable: {
                                type: 'text',
                                showbuttons: 'bottom',
                                validate: function (value) {
                                    if (!value || $.trim(value).length < 1) {
                                 ");
                WriteLiteral(@"       return '請填寫手機號!';
                                    }
                                    return '';
                                }
                            }
                        },
                        {
                            field: 'LoginIp',
                            title: '最後一次登入IP',
                            sortable: true
                        },
                        {
                            field: 'LastLoginTime',
                            title: '最後一次登入時間',
                            sortable: true
                        },
                        {
                            field: 'RoleTid',
                            title: '角色id',
                            visible: false
                        },
                        {
                            field: 'RoleDesc',
                            title: '角色描述',
                            visible: false
                        },
                        {
                            field: 'RoleNa");
                WriteLiteral(@"me',
                            title: '所屬角色',
                            formatter: RoleDetailFormatter,
                            sortable: true
                        },
                        {
                            field: 'CreateUser',
                            title: '建立者',
                        },
                        {
                            field: 'UserAgent',
                            title: 'UserAgent',
                            formatter: LongStringFormatter
                        }
                    ],
                    onLoadSuccess: function () {
                        Tipped.create('.tip_infomation',
                            function (element) {
                                return ""<strong>"" + $(element).data('content') + ""</strong>"";
                            });
                    },
                    onToggle: function () {
                        tipReCreate();

                    },
                    onEditableSave: function (field, row, old");
                WriteLiteral(@"Value, $el) {
                        QQT.ajax('/Admin/Account/ChangeField',
                            'Post',
                            {
                                tid: row.Tid,
                                field: field,
                                value: row[field]
                            })
                            .done(function (response) {
                                $('#SystemUsewrTable').bootstrapTable('refresh', { silent: true });

                                if (response.Info) {
                                    swal({
                                        title: ""更新失敗"",
                                        text: response.Info,
                                        type: ""error""
                                    });
                                    return;
                                }

                                swal({
                                    title: ""成功啦！"",
                                    text: ""修改成功！"",
                         ");
                WriteLiteral(@"           type: ""success""
                                });
                            });
                    }
                });
            $(window).resize(function () {

                tipReCreate();
                $('#SystemUsewrTable').bootstrapTable('resetView', { height: $(window).height() });
            });

            //載入所有的角色
            QQT.ajax('/Admin/Role/GetAllRoleList', 'Post')
                .done(function (response) {
                    if (response.Data.length > 0) {
                        vm.noRole = false;
                    }
                    InitRoleCombobox(response.Data);
                    InitRoleCombobox2(response.Data);
                    InitRoleCombobox1(response.Data);
                });
        });

        $(""#roleCombox1"").change(function () {
            $("".bootstrap-table button[name='refresh']"")[0].click();
        });

        function tipReCreate() {
            setTimeout(function () {
                Tipped.create('.tip_infomation',
           ");
                WriteLiteral(@"         function (element) {
                        return ""<strong>"" + $(element).data('content') + ""</strong>"";
                    });

            },
                200);

        }

        function LongStringFormatter(value, row, index) {
            if (!value) return '-';
            if (value.length <= 15) {
                return value;
            } else {
                return ""<div class='tip_infomation' data-content='"" +
                    QQT.InsertEnter(value, 10) +
                    ""'>"" +
                    value.substring(0, 15) +
                    ""...</div>"";
            }
        }

        function RoleDetailFormatter(value, row, index) {

            return ""<a class='tip_infomation' data-content='角色描述:<br>"" +
                QQT.InsertEnter(row.RoleDesc, 20) +
                ""'>"" +
                value +
                ""</a>"";
        }

        function EmailFormatter(value, row, index) {
            return ""<a href=\""mailto:"" +
                value +
                ""?");
                WriteLiteral(@"subject=[CB] 行李寄存\""'>"" +
                value +
                ""</a>"";
        }


        function InitRoleCombobox(data) {
            var searchList = new Array();
            $.each(data,
                function (index, item) {
                    searchList.push({
                        id: item.Tid,
                        text: item.RoleName
                    });
                });

            $roleCombox.select2({
                data: searchList,
                placeholder: '請選擇',
                multiple: false,
                //createSearchChoice: function (term, data) {
                //    if ($(data).filter(function () {
                //        return this.text.localeCompare(term) === 0;
                //    }).length === 0)
                //    { return { id: term, text: term }; }
                //}
            });
        }

        function InitRoleCombobox1(data) {
            var searchList = new Array();
            searchList.push({
                id: 0,
                t");
                WriteLiteral(@"ext: '全部'
            });
            $.each(data,
                function (index, item) {
                    searchList.push({
                        id: item.Tid,
                        text: item.RoleName
                    });
                });

            $('#roleCombox1').select2({
                data: searchList,
                placeholder: '篩選角色',
                multiple: false
            });
        }

        function InitRoleCombobox2(data) {
            var searchList = new Array();
            $.each(data,
                function (index, item) {
                    searchList.push({
                        id: item.Tid,
                        text: item.RoleName
                    });
                });

            $('#roleCombox2').select2({
                data: searchList,
                placeholder: '請選擇',
                multiple: false
            });
        }

        function ajaxRequest(params) {
            var pageSize = params.data.limit;
            var pageIndex =");
                WriteLiteral(@" params.data.offset / params.data.limit + 1;
            var orderBy = params.data.sort;
            var orderSequence = params.data.order;
            QQT.ajax('/Admin/Account/GetUserList',
                'POST',
                {
                    pageIndex: pageIndex,
                    pageSize: pageSize,
                    orderBy: orderBy,
                    orderSequence: orderSequence,
                    UserName: $.trim($('#UserName').val()),
                    Eid: $.trim($('#Eid').val()),
                    RoleTid: $('#roleCombox1').select2('data') && $('#roleCombox1').select2('data').id || 0
                })
                .done(function (response) {
                    params.success({
                        total: response.Total,
                        rows: response.Rows
                    });
                });

        }


    </script>

");
            }
            );
        }
        #pragma warning restore 1998
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.ViewFeatures.IModelExpressionProvider ModelExpressionProvider { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.IUrlHelper Url { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.IViewComponentHelper Component { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.Rendering.IJsonHelper Json { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.Rendering.IHtmlHelper<dynamic> Html { get; private set; }
    }
}
#pragma warning restore 1591
